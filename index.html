<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>To ÂçøÊ≤•Â∞π | 2026 Êñ∞Âπ¥Âø´‰πê</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/" } }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@400;900&family=Orbitron:wght@500;900&family=Rajdhani:wght@600;700&display=swap');
        :root { --eva-red:#e60012; --eva-orange:#ff9d00; --eva-dark:#080000; --eva-green:#39ff14; }
        body { margin:0; overflow:hidden; background-color:var(--eva-dark); font-family:'Noto Sans SC',sans-serif; color:#fff; -webkit-font-smoothing:antialiased; cursor:crosshair; user-select:none; }
        .hex-bg { position:fixed; inset:0; pointer-events:none; z-index:1; opacity:0.1; background-image:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 0l25.98 15v30L30 60 4.02 45V15z' fill='none' stroke='%23e60012' stroke-width='1'/%3E%3C/svg%3E"); }
        
        /* Âä†ËΩΩÂ±è */
        #loader-screen { position:fixed; inset:0; z-index:9999; background:#000; display:flex; flex-direction:column; justify-content:center; align-items:center; transition:opacity 0.8s ease; }
        .loader-logo { font-family:'Orbitron'; font-size:2rem; color:var(--eva-red); font-weight:900; letter-spacing:5px; margin-bottom:20px; text-shadow:0 0 10px var(--eva-red); }
        .loader-bar-box { width:300px; height:4px; background:#330000; position:relative; }
        .loader-progress { width:0%; height:100%; background:var(--eva-red); transition:width 0.2s; box-shadow:0 0 10px var(--eva-red); }

        /* UI */
        #ui-layer { position:absolute; inset:0; z-index:50; transition:opacity 1s ease; }
        .top-deco { position:absolute; top:0; left:0; width:100%; height:40px; background:linear-gradient(to bottom,rgba(230,0,18,0.1),transparent); border-bottom:1px solid rgba(230,0,18,0.3); display:flex; justify-content:space-between; padding:0 20px; align-items:center; font-family:'Rajdhani'; color:var(--eva-orange); font-size:12px; letter-spacing:2px; }
        .pilot-card { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; width:320px; z-index:40; pointer-events:none; }
        .asuka-frame { position:relative; width:180px; height:180px; margin:0 auto 20px; border:2px solid var(--eva-red); background:rgba(0,0,0,0.8); clip-path:polygon(15% 0,100% 0,100% 85%,85% 100%,0 100%,0 15%); box-shadow:0 0 30px rgba(230,0,18,0.3); overflow:hidden; }
        .asuka-frame img { width:100%; height:100%; object-fit:cover; filter:contrast(1.1) sepia(0.1); }
        .scan-line { position:absolute; top:0; left:0; width:100%; height:2px; background:rgba(255,255,255,0.5); box-shadow:0 0 10px rgba(255,255,255,0.8); animation:scan 3s infinite linear; }
        @keyframes scan { 0%{top:0%;opacity:0} 10%{opacity:1} 90%{opacity:1} 100%{top:100%;opacity:0} }
        
        /* ÊñáÂ≠óÂ¢ûÂº∫ */
        .main-title { font-family:'Ma Shan Zheng',cursive; font-size:3.5rem; color:#fff; text-shadow:3px 3px 0 var(--eva-red); margin-bottom:5px; }
        .new-year-wish { font-family:'Ma Shan Zheng'; font-size:1.8rem; color:var(--eva-orange); text-shadow:0 0 10px var(--eva-red); margin-bottom:10px; animation:pulse-text 2s infinite; }
        @keyframes pulse-text { 0%,100%{opacity:1} 50%{opacity:0.7} }
        .sub-code { font-family:'Orbitron',sans-serif; color:var(--eva-green); font-size:0.8rem; letter-spacing:4px; background:rgba(0,255,0,0.1); padding:4px 12px; display:inline-block; border:1px solid var(--eva-green); }

        /* ËøûÁ∫ø */
        .hex-node { position:absolute; width:40px; height:40px; transform:translate(-50%,-50%); cursor:pointer; z-index:80; display:flex; align-items:center; justify-content:center; pointer-events:auto; }
        .hex-shape { width:100%; height:100%; background:rgba(30,0,0,0.9); clip-path:polygon(50% 0%,100% 25%,100% 75%,50% 100%,0% 75%,0% 25%); box-shadow:inset 0 0 10px var(--eva-red); display:flex; align-items:center; justify-content:center; }
        .hex-core { width:8px; height:8px; background:var(--eva-red); clip-path:inherit; animation:pulse-core 1s infinite; }
        .hex-node.active .hex-shape { background:var(--eva-red); } .hex-node.active .hex-core { background:#fff; }
        .msg-box { position:absolute; transform:translate(-50%,-120%); background:rgba(0,0,0,0.9); border:1px solid var(--eva-orange); border-left:5px solid var(--eva-red); padding:8px 12px; color:#fff; font-size:14px; white-space:nowrap; font-weight:bold; box-shadow:0 0 15px rgba(255,157,0,0.4); pointer-events:none; opacity:0; animation:msgIn 0.3s forwards; }
        
        #final-ui { position:absolute; bottom:10%; left:0; width:100%; text-align:center; z-index:90; opacity:0; pointer-events:none; transition:opacity 1s; }
        .btn-launch { background:linear-gradient(90deg,#990000,#ff0000); border:2px solid #fff; color:#fff; padding:15px 40px; font-family:'Orbitron'; font-weight:900; letter-spacing:2px; font-size:1.2rem; cursor:pointer; box-shadow:0 0 30px var(--eva-red); clip-path:polygon(10% 0,100% 0,100% 70%,90% 100%,0 100%,0 30%); transition:transform 0.1s; }
        .btn-launch:active { transform:scale(0.95); }
        #svg-layer { position:absolute; inset:0; z-index:45; pointer-events:none; }
        .link-line { fill:none; stroke:var(--eva-orange); stroke-width:2; stroke-dasharray:1000; stroke-dashoffset:1000; filter:drop-shadow(0 0 5px var(--eva-red)); animation:draw 0.5s forwards; }
        @keyframes draw { to{stroke-dashoffset:0} } @keyframes msgIn { from{opacity:0;transform:translate(-50%,-100%)} to{opacity:1;transform:translate(-50%,-120%)} }

        /* Áõ∏ÂÜå */
        #gallery-layer { position:absolute; inset:0; z-index:10; opacity:0; pointer-events:none; }
        .gallery-track { display:flex; height:100%; transition:transform 1.2s cubic-bezier(0.2,0.8,0.2,1); }
        .slide { min-width:100vw; height:100%; position:relative; overflow:hidden; border-right:4px solid #000; display:flex; justify-content:center; align-items:center; background:#000; }
        .slide img { width:100%; height:100%; object-fit:contain; transform:scale(1.0); transition:transform 6s ease-out; }
        .slide.active img { transform:scale(1.05); }
        .alert-frame { position:absolute; inset:0; pointer-events:none; z-index:30; box-shadow:inset 0 0 50px rgba(230,0,18,0.3); border:2px solid rgba(230,0,18,0.1); }
        .year-tag { position:absolute; bottom:30px; right:30px; z-index:40; text-align:right; }
        .year-num { font-family:'Orbitron'; font-size:3rem; font-weight:900; color:#fff; text-shadow:2px 2px 0 var(--eva-red); line-height:1; }
    </style>
</head>
<body>

    <div id="loader-screen">
        <div class="loader-logo">NERV SYSTEM</div>
        <div class="text-xs text-red-500 mb-2 tracking-widest font-mono">LOADING 2025 MEMORIES...</div>
        <div class="loader-bar-box"><div class="loader-progress" id="progress"></div></div>
    </div>

    <div class="hex-bg"></div>
    <div id="canvas-container" style="position:absolute; inset:0; z-index:0;"></div>

    <!-- PART 1 -->
    <div id="ui-layer">
        <div class="top-deco"><span>SOUND ONLY</span><span>PATTERN: RED</span><span>2025 FINAL</span></div>
        <svg id="svg-layer"></svg>
        <div id="nodes-container"></div>

        <div class="pilot-card" id="pilot-info">
            <div class="asuka-frame">
                <img src="bg.jpg" onerror="this.src='https://via.placeholder.com/200x200/300/fff?text=NO+IMAGE'" alt="Pilot">
                <div class="scan-line"></div>
                <div style="position:absolute; top:5px; right:5px; font-size:9px; color:var(--eva-orange);">UNIT-02</div>
            </div>
            <h1 class="main-title">ÂçøÊ≤•Â∞π</h1>
            <!-- ÊòæÁúºÁöÑÊñ∞Âπ¥Á•ùÁ¶è -->
            <div class="new-year-wish">‚ú® 2026 Êñ∞Âπ¥Âø´‰πê ‚ú®</div>
            <div class="sub-code">SYNC RATE: <span id="sync-val">0.0%</span></div>
            <p class="mt-4 text-red-400/80 text-xs tracking-widest font-sans animate-pulse">[ Á≠âÂæÖÂª∫Á´ãÁ•ûÁªèËøûÊé•... ]</p>
        </div>

        <div id="final-ui">
            <h2 class="text-2xl font-bold text-white mb-6 tracking-widest drop-shadow-[0_0_10px_#ff0000]">2025 ÂõûÂøÜÂ∫ìÂ∑≤Â∞±Áª™</h2>
            <button id="enter-btn" class="btn-launch">Ëß£Èô§ÈôêÂà∂</button>
        </div>
    </div>

    <!-- PART 2 -->
    <div id="gallery-layer">
        <div id="particle-canvas" style="position:absolute; inset:0; z-index:15;"></div>
        <div class="gallery-track" id="gallery-track"></div>
        <div class="alert-frame"></div>
        <div class="year-tag">
            <div class="year-num">2025</div>
            <div class="text-xs text-orange-500 font-mono tracking-widest">ARCHIVE UNLOCKED</div>
        </div>
    </div>

    <!-- Èü≥È¢ëÁ≥ªÁªü -->
    <!-- bgm.mp3: Á¨¨‰∏ÄÈÉ®ÂàÜËÉåÊôØÈü≥‰πê -->
    <audio id="bgm1" src="./bgm.mp3" loop></audio>
    <!-- bgm2.mp3: Á¨¨‰∫åÈÉ®ÂàÜÂõûÂøÜÈü≥‰πê -->
    <audio id="bgm2" src="./bgm2.mp3" loop></audio>

    <script type="module">
        import * as THREE from 'three';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        const Config = {
            wishes: [
                "üéâ ÂçøÊ≤•Â∞πÔºåÊñ∞Âπ¥Âø´‰πêÔºÅ",
                "üßß 2026ÔºåÂ•ΩËøêÂÖ®ÂΩí‰Ω†ÔºÅ",
                "üõ°Ô∏è ‰Ω†ÊòØÊàëÁöÑ A.T. Field",
                "üî• Á¨®ËõãÔºåË¶Å‰∏ÄÁõ¥ÂºÄÂøÉÂïä",
                "üîó ÂêåÊ≠•Áéá 400%ÔºåÁÅµÈ≠ÇÂÖ±È∏£",
                "üö´ Á¶ÅÊ≠¢‰∏çÂºÄÂøÉÔºåËøôÊòØÂëΩ‰ª§ÔºÅ",
                "‚ù§Ô∏è 2026ÔºåÁªßÁª≠Ë¢´Áà±ÂåÖÂõ¥"
            ],
            photos: Array.from({length: 17}, (_, i) => `${i + 1}.jpg`),
            gallerySpeed: 4000
        };

        // Èü≥È¢ëÊéßÂà∂
        const audio1 = document.getElementById('bgm1');
        const audio2 = document.getElementById('bgm2');
        
        // Â∞ùËØïËá™Âä®Êí≠Êîæ Part 1
        function tryPlayAudio1() {
            audio1.volume = 0.5;
            audio1.play().catch(()=>{ console.log('Waiting for interaction'); });
        }
        document.body.addEventListener('click', tryPlayAudio1, {once:true});

        // È¢ÑÂä†ËΩΩ
        const loader = {
            total: Config.photos.length + 1,
            loaded: 0,
            init: function() {
                const assets = ['bg.jpg', ...Config.photos];
                assets.forEach(src => {
                    const img = new Image();
                    img.onload = () => this.update();
                    img.onerror = () => this.update();
                    img.src = src;
                });
            },
            update: function() {
                this.loaded++;
                const pct = Math.floor((this.loaded / this.total) * 100);
                document.getElementById('progress').style.width = pct + '%';
                if (this.loaded >= this.total) {
                    setTimeout(() => {
                        document.getElementById('loader-screen').style.opacity = 0;
                        setTimeout(() => document.getElementById('loader-screen').remove(), 800);
                        tryPlayAudio1(); // Âä†ËΩΩÂÆåÂ∞ùËØïÊí≠Êîæ
                    }, 500);
                }
            }
        };
        loader.init();

        // Three.js ËÉåÊôØ
        const world = new (class {
            constructor() {
                this.scene = new THREE.Scene();
                this.camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
                this.camera.position.z = 50;
                this.renderer = new THREE.WebGLRenderer({ antialias: false, alpha: true });
                this.renderer.setSize(innerWidth, innerHeight);
                this.renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
                document.getElementById('canvas-container').appendChild(this.renderer.domElement);
                this.composer = new EffectComposer(this.renderer);
                this.composer.addPass(new RenderPass(this.scene, this.camera));
                this.composer.addPass(new UnrealBloomPass(new THREE.Vector2(innerWidth, innerHeight), 1.5, 0.5, 0.6));
                this.time = 0;
                this.initBg();
                this.animate();
                window.addEventListener('resize', () => this.resize());
            }
            initBg() {
                const mat = new THREE.ShaderMaterial({
                    uniforms: { time: { value: 0 } },
                    vertexShader: `varying vec2 vUv; void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}`,
                    fragmentShader: `uniform float time; varying vec2 vUv; float noise(vec2 p){return sin(p.x*10.+time)*cos(p.y*8.+time*0.5);} void main(){vec2 uv=vUv; vec3 c1=vec3(0.1,0.,0.); vec3 c2=vec3(0.6,0.,0.05); vec3 c3=vec3(1.,0.5,0.); float n=noise(uv*1.5+time*0.1); float n2=noise(uv*3.-time*0.2); vec3 col=mix(c1,c2,n*0.5+0.5); col+=c3*smoothstep(0.45,0.55,n2)*0.3; gl_FragColor=vec4(col*(1.2-length(uv-0.5)*1.5),1.);}`
                });
                this.scene.add(new THREE.Mesh(new THREE.PlaneGeometry(200, 120), mat));
                this.bgMat = mat;
            }
            resize() {
                this.camera.aspect = innerWidth/innerHeight; this.camera.updateProjectionMatrix();
                this.renderer.setSize(innerWidth,innerHeight); this.composer.setSize(innerWidth,innerHeight);
            }
            animate() {
                requestAnimationFrame(() => this.animate());
                this.time += 0.008; this.bgMat.uniforms.time.value = this.time;
                this.composer.render();
            }
        })();

        // ËøûÁ∫øÊ∏∏Êàè
        const SyncGame = new (class {
            constructor() {
                this.container = document.getElementById('nodes-container');
                this.svg = document.getElementById('svg-layer');
                this.syncEl = document.getElementById('sync-val');
                this.pilotInfo = document.getElementById('pilot-info');
                this.points = [{x:50,y:25},{x:75,y:35},{x:80,y:60},{x:50,y:85},{x:20,y:60},{x:25,y:35},{x:50,y:25}];
                this.init();
            }
            init() { this.spawnNode(0); }
            spawnNode(index) {
                if (index >= this.points.length) { this.finish(); return; }
                const pos = this.points[index];
                const node = document.createElement('div');
                node.className = 'hex-node';
                node.innerHTML = `<div class="hex-shape"><div class="hex-core"></div></div>`;
                node.style.left = pos.x+'%'; node.style.top = pos.y+'%';
                node.onclick = (e) => {
                    e.stopPropagation(); if(node.classList.contains('active')) return;
                    node.classList.add('active');
                    if(index===0) this.pilotInfo.style.opacity = 0.3;
                    this.showMsg(Config.wishes[index] || "SYNC COMPLETE", pos.x, pos.y);
                    const rate = Math.floor(((index+1)/this.points.length)*400);
                    this.syncEl.innerText = rate + "%"; this.syncEl.style.color = "#39ff14";
                    if(index>0) this.drawLine(this.points[index-1], pos);
                    if(index<this.points.length-1) this.spawnNode(index+1);
                    else setTimeout(() => this.finish(), 600);
                };
                this.container.appendChild(node);
            }
            drawLine(start, end) {
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", start.x+"%"); line.setAttribute("y1", start.y+"%");
                line.setAttribute("x2", end.x+"%"); line.setAttribute("y2", end.y+"%");
                line.setAttribute("class", "link-line");
                this.svg.appendChild(line);
            }
            showMsg(text, x, y) {
                const el = document.createElement('div'); el.className = 'msg-box'; el.innerText = text;
                el.style.left = x+'%'; el.style.top = y+'%';
                this.container.appendChild(el);
            }
            finish() {
                document.getElementById('final-ui').style.opacity = 1;
                document.getElementById('final-ui').style.pointerEvents = 'auto';
                this.syncEl.innerText = "400% (MAX)";
            }
        })();

        // ËΩ¨Âú∫‰∏éÂàáÊç¢
        const enterBtn = document.getElementById('enter-btn');
        const part1 = document.getElementById('ui-layer');
        const part2 = document.getElementById('gallery-layer');
        const track = document.getElementById('gallery-track');

        Config.photos.forEach(src => {
            const d = document.createElement('div'); d.className = 'slide';
            const img = document.createElement('img'); img.src = src;
            img.onerror = () => { d.style.display = 'none'; };
            d.appendChild(img); track.appendChild(d);
        });

        enterBtn.addEventListener('click', () => {
            // ÂàáÊç¢Èü≥‰πê
            audio1.pause();
            audio2.volume = 0.8;
            audio2.currentTime = 0;
            audio2.play().catch(e=>console.log(e));

            part1.style.opacity = 0; part1.style.pointerEvents = 'none';
            part2.style.opacity = 1;
            
            initExplosion();
            setTimeout(() => {
                document.getElementById('particle-canvas').style.transition = 'opacity 2s';
                document.getElementById('particle-canvas').style.opacity = 0;
                startGallery();
            }, 2500);
        });

        function initExplosion() {
            const container = document.getElementById('particle-canvas');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
            camera.position.z = 100;
            const renderer = new THREE.WebGLRenderer({alpha:true});
            renderer.setSize(innerWidth, innerHeight);
            container.appendChild(renderer.domElement);
            const count = 6000;
            const pos = new Float32Array(count*3); const vel = new Float32Array(count*3); const col = new Float32Array(count*3);
            const c1 = new THREE.Color('#e60012'); const c2 = new THREE.Color('#ff9d00');
            for(let i=0; i<count; i++) {
                const i3 = i*3; pos[i3]=0; pos[i3+1]=0; pos[i3+2]=0;
                const s = 5+Math.random()*20; const theta=Math.random()*Math.PI*2; const phi=Math.acos(2*Math.random()-1);
                vel[i3]=s*Math.sin(phi)*Math.cos(theta); vel[i3+1]=s*Math.sin(phi)*Math.sin(theta); vel[i3+2]=s*Math.cos(phi);
                const c=Math.random()>0.6?c1:c2; col[i3]=c.r; col[i3+1]=c.g; col[i3+2]=c.b;
            }
            const geo = new THREE.BufferGeometry(); geo.setAttribute('position', new THREE.BufferAttribute(pos, 3)); geo.setAttribute('color', new THREE.BufferAttribute(col, 3));
            const mat = new THREE.PointsMaterial({size:2.0, vertexColors:true, blending:THREE.AdditiveBlending, transparent:true});
            const mesh = new THREE.Points(geo, mat); scene.add(mesh);
            function loop() {
                requestAnimationFrame(loop);
                const p = geo.attributes.position.array;
                for(let i=0; i<count; i++) {
                    const i3 = i*3; p[i3]+=vel[i3]; p[i3+1]+=vel[i3+1]; p[i3+2]+=vel[i3+2];
                    vel[i3]*=0.9; vel[i3+1]*=0.9; vel[i3+2]*=0.9;
                }
                geo.attributes.position.needsUpdate=true; mat.opacity-=0.01;
                renderer.render(scene, camera);
            }
            loop();
        }

        function startGallery() {
            let idx = 0;
            const slides = document.querySelectorAll('.slide');
            const visibleSlides = Array.from(slides).filter(s => s.style.display !== 'none');
            const next = () => {
                visibleSlides.forEach(s => s.classList.remove('active'));
                track.style.transform = `translateX(-${idx * 100}vw)`;
                setTimeout(() => { if(visibleSlides[idx]) visibleSlides[idx].classList.add('active'); }, 50);
                idx = (idx + 1) % visibleSlides.length;
            };
            next();
            setInterval(next, Config.gallerySpeed);
        }
    </script>
</body>
</html>

